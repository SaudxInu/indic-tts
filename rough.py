data = [
    {
        "language": "hindi",
        "user_id": 159,
        "utterance": "नमस्ते, आज मैंने पूरे दिन घर पर बैठकर किताबें पढ़ीं और कुछ नई रेसिपी बनाने की कोशिश की जो मेरे परिवार को बहुत पसंद आई।",
    },
    {
        "language": "hindi",
        "user_id": 159,
        "utterance": "कल मैं अपने दोस्तों के साथ बाज़ार गया और हमने कई घंटों तक अलग-अलग दुकानों में घूमकर खरीदारी की।",
    },
    {
        "language": "hindi",
        "user_id": 159,
        "utterance": "मुझे लगता है कि इस बार की बारिश पिछले साल से ज्यादा होगी क्योंकि मौसम का मिज़ाज काफी बदल गया है।",
    },
    {
        "language": "hindi",
        "user_id": 159,
        "utterance": "आज सुबह मैंने पार्क में दौड़ लगाई और वहां की ताज़ी हवा और पक्षियों की चहचहाहट ने मेरा दिन बना दिया।",
    },
    {
        "language": "hindi",
        "user_id": 159,
        "utterance": "सर्दियों में गरम चाय और अलाव के पास बैठकर बातें करना मुझे हमेशा से अच्छा लगता है।",
    },
    {
        "language": "punjabi",
        "user_id": 159,
        "utterance": "ਅੱਜ ਸਵੇਰੇ ਮੈਂ ਆਪਣੇ ਖੇਤ ਵਿੱਚ ਗਿਆ ਤੇ ਵੇਖਿਆ ਕਿ ਸਾਰੀਆਂ ਫਸਲਾਂ ਬਹੁਤ ਸੋਹਣੀਆਂ ਤਰ੍ਹਾਂ ਵਧ ਰਹੀਆਂ ਹਨ।",
    },
    {
        "language": "punjabi",
        "user_id": 159,
        "utterance": "ਕੱਲ੍ਹ ਮੈਂ ਆਪਣੇ ਦੋਸਤ ਨਾਲ ਸ਼ਹਿਰ ਗਿਆ ਜਿੱਥੇ ਅਸੀਂ ਲੰਬੇ ਸਮੇਂ ਤੱਕ ਕਾਫੀ ਪੀ ਕੇ ਗੱਲਾਂ ਕਰਦੇ ਰਹੇ।",
    },
    {
        "language": "punjabi",
        "user_id": 159,
        "utterance": "ਮੇਰੇ ਪਿੰਡ ਦਾ ਮੇਲਾ ਬਹੁਤ ਮਸ਼ਹੂਰ ਹੈ ਅਤੇ ਹਰ ਸਾਲ ਦੂਰ-ਦੂਰ ਤੋਂ ਲੋਕ ਇਸਨੂੰ ਵੇਖਣ ਆਉਂਦੇ ਹਨ।",
    },
    {
        "language": "punjabi",
        "user_id": 159,
        "utterance": "ਅੱਜ ਮੌਸਮ ਇੰਨਾ ਵਧੀਆ ਹੈ ਕਿ ਦਿਲ ਕਰਦਾ ਹੈ ਪੂਰਾ ਦਿਨ ਬਾਹਰ ਕੁਝ ਸਮਾਂ ਬਿਤਾਇਆ ਜਾਵੇ।",
    },
    {
        "language": "punjabi",
        "user_id": 159,
        "utterance": "ਮੈਨੂੰ ਰਾਤ ਨੂੰ ਪਰਿਵਾਰ ਨਾਲ ਛੱਤ ਤੇ ਬੈਠ ਕੇ ਗੱਲਾਂ ਕਰਨਾ ਬਹੁਤ ਪਸੰਦ ਹੈ।",
    },
    {
        "language": "marathi",
        "user_id": 159,
        "utterance": "आज सकाळी मी लवकर उठून मंदीरात जाऊन प्रार्थना केली आणि दिवसाची सुरुवात केली।",
    },
    {
        "language": "marathi",
        "user_id": 159,
        "utterance": "गेल्या आठवड्यात आम्ही संपूर्ण कुटुंबाने एकत्र येऊन गावात सण साजरा केला।",
    },
    {
        "language": "marathi",
        "user_id": 159,
        "utterance": "संध्याकाळी घराजवळच्या बागेत फिरायला जाणे मला खूप आवडते कारण तिथे हवा ताजी असते।",
    },
    {
        "language": "marathi",
        "user_id": 159,
        "utterance": "काल मी नवीन पाककृती करून पाहिली आणि ती सर्वांना खूप आवडली।",
    },
    {
        "language": "marathi",
        "user_id": 159,
        "utterance": "पावसाळ्यात गरम वडापाव आणि चहा घेणे ही खरी मजा असते।",
    },
    {
        "language": "tamil",
        "user_id": 159,
        "utterance": "இன்று காலை எழுந்தவுடன் கடற்கரைக்கு சென்று அங்கு அலைகளை பார்த்து மிகவும் மகிழ்ந்தேன்.",
    },
    {
        "language": "tamil",
        "user_id": 159,
        "utterance": "நேற்று மாலையில் நண்பர்களுடன் சேர்ந்து சினிமா பார்த்தோம், அது மிகவும் சுவாரஸ்யமாக இருந்தது.",
    },
    {
        "language": "tamil",
        "user_id": 159,
        "utterance": "எங்கள் வீட்டில் இன்று ஒரு சிறிய விழா நடந்தது, அதில் உறவினர்கள் அனைவரும் கலந்து கொண்டனர்.",
    },
    {
        "language": "tamil",
        "user_id": 159,
        "utterance": "மழைக்காலத்தில் சூடான காபி குடித்து புத்தகம் படிப்பது எனக்கு மிகவும் பிடிக்கும்.",
    },
    {
        "language": "tamil",
        "user_id": 159,
        "utterance": "கிராமத்திற்கு சென்றால் பசுமையான வயல்களை பார்க்கும் அனுபவம் மறக்க முடியாதது.",
    },
    {
        "language": "telugu",
        "user_id": 159,
        "utterance": "ఈ రోజు ఉదయం నేను పార్క్ లో నడుస్తూ పక్షుల కిలకిలారావాలు విన్నాను.",
    },
    {
        "language": "telugu",
        "user_id": 159,
        "utterance": "నిన్న నేను మా స్నేహితులతో కలిసి సినిమా చూసి చాలా సంతోషించాను.",
    },
    {
        "language": "telugu",
        "user_id": 159,
        "utterance": "వర్షాకాలంలో వేడి చాయ్ తాగుతూ కిటికీ దగ్గర కూర్చోవడం నాకు చాలా ఇష్టం.",
    },
    {
        "language": "telugu",
        "user_id": 159,
        "utterance": "మా ఊరిలో వచ్చే పండుగకు అందరూ ఆసక్తిగా ఎదురుచూస్తున్నారు.",
    },
    {
        "language": "telugu",
        "user_id": 159,
        "utterance": "నిన్న రాత్రి మా ఇంటి మీద చందమామ కాంతి చాలా అందంగా కనిపించింది.",
    },
    {
        "language": "bengali",
        "user_id": 159,
        "utterance": "আজ সকালে আমি নদীর ধারে হাঁটছিলাম এবং ঠান্ডা হাওয়া উপভোগ করছিলাম।",
    },
    {
        "language": "bengali",
        "user_id": 159,
        "utterance": "গতকাল আমি বাজারে গিয়ে অনেক রকমের সবজি কিনে এনেছি।",
    },
    {
        "language": "bengali",
        "user_id": 159,
        "utterance": "বৃষ্টির দিনে গরম চা এবং মুড়ি খাওয়ার মজা অন্যরকম।",
    },
    {
        "language": "bengali",
        "user_id": 159,
        "utterance": "আমাদের গ্রামের মেলা প্রতি বছর খুব ধুমধাম করে হয়।",
    },
    {
        "language": "bengali",
        "user_id": 159,
        "utterance": "আজ বিকেলে আমি বইয়ের দোকানে গিয়ে নতুন উপন্যাস কিনেছি।",
    },
    {
        "language": "gujarati",
        "user_id": 159,
        "utterance": "આજે સવારે હું બગીચામાં ફરી આવ્યો અને તાજી હવાની મજા માણી.",
    },
    {
        "language": "gujarati",
        "user_id": 159,
        "utterance": "ગઈકાલે હું મારા મિત્રો સાથે બજારમાં ગયો હતો અને ઘણી ખરીદી કરી.",
    },
    {
        "language": "gujarati",
        "user_id": 159,
        "utterance": "વરસાદમાં ગરમ ભજિયા અને ચા પીવાનો આનંદ જ કંઈક અલગ છે.",
    },
    {
        "language": "gujarati",
        "user_id": 159,
        "utterance": "અમારા ગામમાં આવતી કાલે મેળો ભરાશે.",
    },
    {
        "language": "gujarati",
        "user_id": 159,
        "utterance": "ગઈ રાતે ચાંદની એટલી સુંદર લાગી કે આંખો હટતી ન હતી.",
    },
    {
        "language": "malayalam",
        "user_id": 159,
        "utterance": "ഇന്ന് രാവിലെ ഞാൻ കടപ്പുറത്ത് പോയി തിരമാലകൾ കണ്ടു.",
    },
    {
        "language": "malayalam",
        "user_id": 159,
        "utterance": "ഇന്നലെ വൈകുന്നേരം ഞാൻ സുഹൃത്തുക്കളുമായി സിനിമ കാണാൻ പോയി.",
    },
    {
        "language": "malayalam",
        "user_id": 159,
        "utterance": "മഴക്കാലത്ത് ചായ കുടിച്ച് പുസ്തകം വായിക്കുന്നത് എനിക്ക് ഇഷ്ടമാണ്.",
    },
    {
        "language": "malayalam",
        "user_id": 159,
        "utterance": "ഞങ്ങളുടെ ഗ്രാമത്തിലെ ഉത്സവം വളരെ പ്രശസ്തമാണ്.",
    },
    {
        "language": "malayalam",
        "user_id": 159,
        "utterance": "ഇന്നലെ രാത്രി ചന്ദ്രന്റെ പ്രകാശം അതിശയകരമായിരുന്നു.",
    },
    {
        "language": "kannada",
        "user_id": 159,
        "utterance": "ಇಂದು ಬೆಳಿಗ್ಗೆ ನಾನು ಉದ್ಯಾನವನದಲ್ಲಿ ನಡೆಯುತ್ತಿದ್ದಾಗ ಹಕ್ಕಿಗಳ ಕಿಲಕಿಲಾರವ ಕೇಳಿಸಿತು.",
    },
    {
        "language": "kannada",
        "user_id": 159,
        "utterance": "ನಿನ್ನೆ ನಾನು ನನ್ನ ಸ್ನೇಹಿತರೊಂದಿಗೆ ಸಿನಿಮಾವನ್ನು ನೋಡಲು ಹೋದೆ.",
    },
    {
        "language": "kannada",
        "user_id": 159,
        "utterance": "ಮಳೆಗಾಲದಲ್ಲಿ ಬಿಸಿ ಚಹಾ ಕುಡಿಯುತ್ತ ಪುಸ್ತಕ ಓದುವುದು ನನಗೆ ತುಂಬ ಇಷ್ಟ.",
    },
    {
        "language": "kannada",
        "user_id": 159,
        "utterance": "ನಮ್ಮ ಊರಿನಲ್ಲಿ ನಡೆಯುವ ಜಾತ್ರೆ ಬಹಳ ಪ್ರಸಿದ್ಧವಾಗಿದೆ.",
    },
    {
        "language": "kannada",
        "user_id": 159,
        "utterance": "ನಿನ್ನೆ ರಾತ್ರಿ ಚಂದಿರನ ಬೆಳಕು ಅತಿ ಸುಂದರವಾಗಿತ್ತು.",
    },
]


import asyncio
import time
import uuid

import pandas as pd
from vllm import SamplingParams
from vllm.engine.arg_utils import AsyncEngineArgs
from vllm.sampling_params import RequestOutputKind
from vllm.v1.engine.async_llm import AsyncLLM


def get_sampling_params():
    return SamplingParams(
        temperature=0.4,
        top_p=0.9,
        max_tokens=2048,
        repetition_penalty=1.05,
        stop_token_ids=[128258],
    )


async def run(prompt, engine, sampling_params):
    start = time.perf_counter()
    end = None
    async for output in engine.generate(
        request_id=uuid.uuid4().hex, prompt=prompt, sampling_params=sampling_params
    ):
        if end is None:
            end = time.perf_counter()
        if output.finished:
            break
    elapsed_time = end - start
    return {
        "time": elapsed_time,
    }
    

async def main():    
    engine_args = AsyncEngineArgs(
        model="snorbyte/snorTTS-Indic-v0",
        quantization="fp8",
    )
    engine = AsyncLLM.from_engine_args(engine_args)
    
    sampling_params = get_sampling_params()

    for _ in range(10):
        row = data[0]
    
        prompt = f"<custom_token_3><|begin_of_text|>{row['language']}{row['user_id']}: {row['utterance']}<|eot_id|><custom_token_4><custom_token_5><custom_token_1>"
    
        _ = await run(prompt, engine, sampling_params)

    logs = []
    for _ in range(5):
        for row in data:
            prompt = f"<custom_token_3><|begin_of_text|>{row['language']}{row['user_id']}: {row['utterance']}<|eot_id|><custom_token_4><custom_token_5><custom_token_1>"
    
            log = await run(prompt, engine, sampling_params)
    
            logs.append(log)

    engine.shutdown()

    return logs


if __name__ == "__main__":
    logs = asyncio.run(main())

    df = pd.DataFrame(logs)

    print(df.describe().to_string())